<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>A Year in NYC</title>

    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>

    <style type="text/css">
        text {
            font-family: sans-serif;
            font-size: 8px;
        }
        h1 {
            font-family: sans-serif;
        }
        #map-canvas { 
          height: 500px;
          width: 800px;
        }
    </style>
  </head>

  <body>
    <h1>???</h1>
    <div id="map-canvas"></div>

    <script type="text/javascript">
      var map = L.map("map-canvas").setView([40.733889, -73.950611], 12);
      L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

      var all_data = d3.json("filt_locs.json", function(data){

        //TODO: sort keys first by time

        for (var i=0; i<Object.keys(data).length; i++) (function(t) {
          window.setTimeout(function() {
           x = Object.keys(data)[t]
           console.log(x);
            var myLines = [{
              "type": "LineString",
              "coordinates": data[x]
            }]
            var lineStyle = {
              "opacity": 0.65
            }
            L.geoJSON(myLines, {
              style: lineStyle
            }).addTo(map);
          }, t*300)
        }(i)) 

      //   for (i=0; i<data.locations.length; i++) {
      //     current = data.locations[i]
      //     adjLat = current.latitudeE7/10000000
      //     adjLon = current.longitudeE7/10000000
      //     current_date = new Date(parseInt(current.timestampMs));
      //     //TODO: run through python first to filter anything outside of NYC
      //     //organize a json based on date?? then make a line for each date
      //     if (40.5290344 < adjLat && adjLat < 40.9043808 && -74.1598438 < adjLon && adjLon < -73.855481 && current_date.getTime() > moved.getTime()) {
      //       console.log(current_date);
      //       var circle = L.circle([adjLat, adjLon], {
      //         color: 'red',
      //         fillColor: '#f03',
      //         fillOpacity: 0.5,
      //         radius: 50
      //       }).addTo(map);
      //       circle.bindPopup(adjLat + " " + adjLon);
      //     }
      // }
      });
    </script>
  </body>
</html>
